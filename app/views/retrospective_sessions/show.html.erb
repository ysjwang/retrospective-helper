<div class="h-screen w-screen bg-gradient-to-br from-gray-900 via-black to-gray-800 relative overflow-hidden fixed inset-0">
  <!-- Animated background grid -->
  <div class="absolute inset-0 opacity-20">
    <div class="grid grid-cols-12 gap-4 h-full">
      <% 12.times do |i| %>
        <div class="border-l border-lime-400/30 animate-pulse" style="animation-delay: <%= i * 0.1 %>s;"></div>
      <% end %>
    </div>
  </div>

  <!-- Tron-style moving grid - full screen -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="tron-grid-container">
      <div class="tron-grid"></div>
      <div class="tron-grid" style="animation-delay: -2s;"></div>
    </div>
  </div>

  <!-- Main content -->
  <div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-4">
    <!-- Glowing title -->
    <h1 class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-lime-400 via-lime-300 to-yellow-400 mb-8 text-center leading-tight">
      <span class="drop-shadow-2xl" style="text-shadow: 0 0 20px #84cc16, 0 0 40px #84cc16, 0 0 60px #84cc16;">RETRO SESSION</span>
    </h1>

    <!-- Subtitle with neon effect -->
    <p class="text-lg md:text-xl text-lime-300 mb-8 text-center max-w-2xl leading-relaxed" style="text-shadow: 0 0 10px #84cc16;">
      Share this session with your team members
    </p>

    <!-- UUID Input Field and Copy Button -->
    <div class="w-full max-w-2xl mb-6">
      <label class="block text-lime-300 text-sm font-bold mb-2 text-center" style="text-shadow: 0 0 10px #84cc16;">
        Session ID (UUID)
      </label>
      <div class="flex items-center space-x-4">
        <!-- UUID Input Field -->
        <input 
          type="text" 
          value="<%= @retrospective_session.uuid %>" 
          readonly 
          class="flex-1 px-6 py-4 bg-gray-800/50 border-2 border-lime-400 rounded-lg text-lime-300 font-mono text-lg text-center focus:outline-none focus:border-lime-300 focus:ring-2 focus:ring-lime-400/20"
          style="text-shadow: 0 0 10px #84cc16;"
          id="uuid-input"
        />
        
        <!-- Copy Button -->
        <button 
          onclick="copyToClipboard('uuid-input')" 
          class="px-6 py-4 bg-gradient-to-r from-lime-600 to-lime-500 hover:from-lime-500 hover:to-lime-400 text-black font-bold text-lg rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl border-2 border-lime-400"
          id="copy-uuid-button"
        >
          COPY
        </button>
      </div>
    </div>

    <!-- Short URL Input Field and Copy Button -->
    <div class="w-full max-w-2xl mb-8">
      <label class="block text-lime-300 text-sm font-bold mb-2 text-center" style="text-shadow: 0 0 10px #84cc16;">
        Short URL
      </label>
      <div class="flex items-center space-x-4">
        <!-- Short URL Input Field -->
        <input 
          type="text" 
          value="<%= request.base_url %>/retro/<%= @retrospective_session.uuid %>" 
          readonly 
          class="flex-1 px-6 py-4 bg-gray-800/50 border-2 border-lime-400 rounded-lg text-lime-300 font-mono text-lg text-center focus:outline-none focus:border-lime-300 focus:ring-2 focus:ring-lime-400/20"
          style="text-shadow: 0 0 10px #84cc16;"
          id="url-input"
        />
        
        <!-- Copy Button -->
        <button 
          onclick="copyToClipboard('url-input')" 
          class="px-6 py-4 bg-gradient-to-r from-lime-600 to-lime-500 hover:from-lime-500 hover:to-lime-400 text-black font-bold text-lg rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl border-2 border-lime-400"
          id="copy-url-button"
        >
          COPY
        </button>
      </div>
      
      <!-- Copy feedback message -->
      <div id="copy-feedback" class="text-center mt-4 text-lime-300 text-lg hidden" style="text-shadow: 0 0 10px #84cc16;">
        ✓ Copied to clipboard!
      </div>
    </div>

    <!-- Back to Home Button -->
    <%= link_to root_path, class: "group relative px-8 py-4 bg-gradient-to-r from-gray-700 to-gray-600 hover:from-gray-600 hover:to-gray-500 text-lime-300 font-bold text-lg rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl border-2 border-gray-500" do %>
      <span class="relative z-10 tracking-wider" style="text-shadow: 0 0 10px #000000;">
        ← BACK TO HOME
      </span>
    <% end %>

    <!-- Decorative elements -->
    <div class="mt-16 flex space-x-8">
      <div class="w-4 h-4 bg-lime-400 rounded-full animate-ping"></div>
      <div class="w-4 h-4 bg-red-500 rounded-full animate-ping" style="animation-delay: 0.5s;"></div>
      <div class="w-4 h-4 bg-purple-500 rounded-full animate-ping" style="animation-delay: 1s;"></div>
    </div>
  </div>

  <!-- Bottom neon line -->
  <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-lime-400 to-transparent"></div>

  <!-- Floating Add Button -->
  <button 
    onclick="openModal()" 
    class="fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-r from-lime-600 to-lime-500 hover:from-lime-500 hover:to-lime-400 text-black font-bold text-2xl rounded-full transform transition-all duration-300 hover:scale-110 hover:shadow-2xl border-2 border-lime-400 z-50 flex items-center justify-center"
    style="box-shadow: 0 0 20px #84cc16, 0 0 40px #84cc16;"
  >
    +
  </button>
</div>

<!-- Modal -->
<div id="retrospective-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-gray-900 border-2 border-lime-400 rounded-lg p-8 w-full max-w-md mx-4 relative">
    <!-- Close button -->
    <button 
      onclick="closeModal()" 
      class="absolute top-4 right-4 text-lime-400 hover:text-lime-300 text-2xl font-bold"
    >
      ×
    </button>
    
    <!-- Modal title -->
    <h2 class="text-2xl font-bold text-lime-300 mb-6 text-center" style="text-shadow: 0 0 10px #84cc16;">
      Add Retrospective Item
    </h2>
    
    <!-- Form -->
    <form id="retrospective-form" onsubmit="submitForm(event)">
      <!-- Category selection -->
      <div class="mb-6">
        <label class="block text-lime-300 text-sm font-bold mb-2" style="text-shadow: 0 0 10px #84cc16;">
          Category *
        </label>
        <select 
          id="category" 
          required
          class="w-full px-4 py-3 bg-gray-800 border-2 border-lime-400 rounded-lg text-lime-300 focus:outline-none focus:border-lime-300 focus:ring-2 focus:ring-lime-400/20"
        >
          <option value="">Select a category</option>
          <option value="0">Continue</option>
          <option value="1">Start</option>
          <option value="2">Stop</option>
          <option value="3">Misc</option>
        </select>
      </div>
      
      <!-- Name field -->
      <div class="mb-6">
        <label class="block text-lime-300 text-sm font-bold mb-2" style="text-shadow: 0 0 10px #84cc16;">
          Name
        </label>
        <input 
          type="text" 
          id="name" 
          maxlength="255"
          class="w-full px-4 py-3 bg-gray-800 border-2 border-lime-400 rounded-lg text-lime-300 focus:outline-none focus:border-lime-300 focus:ring-2 focus:ring-lime-400/20"
          placeholder="Enter item name (optional)"
        />
      </div>
      
      <!-- Comments field -->
      <div class="mb-6">
        <label class="block text-lime-300 text-sm font-bold mb-2" style="text-shadow: 0 0 10px #84cc16;">
          Comments
        </label>
        <textarea 
          id="comments" 
          rows="4" 
          maxlength="1000"
          class="w-full px-4 py-3 bg-gray-800 border-2 border-lime-400 rounded-lg text-lime-300 focus:outline-none focus:border-lime-300 focus:ring-2 focus:ring-lime-400/20 resize-none"
          placeholder="Enter comments (optional)"
        ></textarea>
      </div>
      
      <!-- Due date field -->
      <div class="mb-8">
        <label class="block text-lime-300 text-sm font-bold mb-2" style="text-shadow: 0 0 10px #84cc16;">
          Due Date
        </label>
        <input 
          type="date" 
          id="due_date" 
          class="w-full px-4 py-3 bg-gray-800 border-2 border-lime-400 rounded-lg text-lime-300 focus:outline-none focus:border-lime-300 focus:ring-2 focus:ring-lime-400/20"
        />
      </div>
      
      <!-- Action buttons -->
      <div class="flex space-x-4">
        <button 
          type="button" 
          onclick="closeModal()" 
          class="flex-1 px-6 py-3 bg-gray-700 hover:bg-gray-600 text-lime-300 font-bold rounded-lg transform transition-all duration-300 hover:scale-105 border-2 border-gray-500"
        >
          Cancel
        </button>
        <button 
          type="submit" 
          class="flex-1 px-6 py-3 bg-gradient-to-r from-lime-600 to-lime-500 hover:from-lime-500 hover:to-lime-400 text-black font-bold rounded-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl border-2 border-lime-400"
        >
          Save
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  /* Tron-style moving grid - seamless no gaps */
  .tron-grid-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .tron-grid {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 200%;
    background-image: 
      linear-gradient(90deg, transparent 0%, transparent 48%, #84cc16 49%, #84cc16 51%, transparent 52%, transparent 100%),
      linear-gradient(0deg, transparent 0%, transparent 48%, #84cc16 49%, #84cc16 51%, transparent 52%, transparent 100%);
    background-size: 80px 80px;
    background-position: 0 0;
    opacity: 0.5;
    animation: tron-move 4s linear infinite;
    transform: rotateX(60deg);
    will-change: transform;
  }

  @keyframes tron-move {
    0% {
      transform: rotateX(60deg) translateY(0%);
    }
    100% {
      transform: rotateX(60deg) translateY(-100%);
    }
  }
</style>

<script>
function copyToClipboard(inputId) {
  const input = document.getElementById(inputId);
  const buttonId = inputId === 'uuid-input' ? 'copy-uuid-button' : 'copy-url-button';
  const copyButton = document.getElementById(buttonId);
  const copyFeedback = document.getElementById('copy-feedback');
  
  // Select the text in the input field
  input.select();
  input.setSelectionRange(0, 99999); // For mobile devices
  
  // Copy to clipboard
  navigator.clipboard.writeText(input.value).then(function() {
    // Show feedback
    copyFeedback.classList.remove('hidden');
    copyButton.textContent = 'COPIED!';
    copyButton.classList.add('from-green-500', 'to-green-400');
    
    // Reset after 2 seconds
    setTimeout(function() {
      copyFeedback.classList.add('hidden');
      copyButton.textContent = 'COPY';
      copyButton.classList.remove('from-green-500', 'to-green-400');
    }, 2000);
  }).catch(function(err) {
    console.error('Could not copy text: ', err);
    // Fallback for older browsers
    try {
      document.execCommand('copy');
      copyFeedback.classList.remove('hidden');
      copyButton.textContent = 'COPIED!';
      copyButton.classList.add('from-green-500', 'to-green-400');
      
      setTimeout(function() {
        copyFeedback.classList.add('hidden');
        copyButton.textContent = 'COPY';
        copyButton.classList.remove('from-green-500', 'to-green-400');
      }, 2000);
    } catch (err) {
      console.error('Fallback copy failed: ', err);
    }
  });
}

// Modal functions
function openModal() {
  const modal = document.getElementById('retrospective-modal');
  modal.classList.remove('hidden');
  document.body.style.overflow = 'hidden'; // Prevent background scrolling
}

function closeModal() {
  const modal = document.getElementById('retrospective-modal');
  modal.classList.add('hidden');
  document.body.style.overflow = 'auto'; // Restore scrolling
  resetForm();
}

function resetForm() {
  document.getElementById('retrospective-form').reset();
}

function submitForm(event) {
  event.preventDefault();
  
  const formData = {
    retrospective_item: {
      category: parseInt(document.getElementById('category').value),
      name: document.getElementById('name').value,
      comments: document.getElementById('comments').value,
      due_date: document.getElementById('due_date').value
    }
  };
  
  // Show loading state
  const submitButton = event.target.querySelector('button[type="submit"]');
  const originalText = submitButton.textContent;
  submitButton.textContent = 'Saving...';
  submitButton.disabled = true;
  
  // Submit the form
  fetch(`/retrospective_sessions/<%= @retrospective_session.id %>/items`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(formData)
  })
  .then(response => {
    if (response.ok) {
      closeModal();
      // You could add a success message here
      showSuccessMessage();
    } else {
      throw new Error('Failed to save item');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Failed to save the retrospective item. Please try again.');
  })
  .finally(() => {
    // Reset button state
    submitButton.textContent = originalText;
    submitButton.disabled = false;
  });
}

function showSuccessMessage() {
  // Create a temporary success message
  const successDiv = document.createElement('div');
  successDiv.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300';
  successDiv.textContent = '✓ Retrospective item saved successfully!';
  document.body.appendChild(successDiv);
  
  // Remove after 3 seconds
  setTimeout(() => {
    successDiv.remove();
  }, 3000);
}

// Close modal when clicking outside
document.getElementById('retrospective-modal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeModal();
  }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const modal = document.getElementById('retrospective-modal');
    if (!modal.classList.contains('hidden')) {
      closeModal();
    }
  }
});
</script>
